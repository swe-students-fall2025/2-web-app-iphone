<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Home • Pets</title>
<style>
  :root{ --bg:#f6f6f6; --card:#ffffff; --muted:#d9d9d9; --text:#222; }
  html,body{ margin:0; padding:0; background:var(--bg); color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif }
  .wrap{ max-width:680px; margin:0 auto; padding:16px }
  .section{ background:var(--card); border-radius:14px; box-shadow:0 1px 6px rgba(0,0,0,.06); padding:14px }
  .header{ background:var(--muted); border-radius:10px; padding:12px 14px; font-size:1.6rem; font-weight:800 }

  .search{ background:var(--muted); border-radius:10px; padding:10px 12px; margin:12px 0; text-align:center; font-size:1.3rem }
  .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px }
  .chip{ border:0; background:#e9e9e9; border-radius:10px; padding:8px 14px }
  .chip.active{ outline:2px solid #000 }

  .card{ background:#ddd; border-radius:12px; padding:12px; margin:16px 0;
         display:grid; grid-template-columns:88px 1fr auto; gap:14px; align-items:center }
  .photo{ background:#eee; border-radius:8px; display:grid; place-items:center; height:88px; font-size:.9rem }
  .meta{ font-size:.98rem }
  .meta .name{ font-weight:700 }
  .meta .line{ margin-top:6px }
  .actions{ display:flex; gap:8px; align-items:center }
  .btn{ border:0; background:#e9e9e9; border-radius:8px; padding:8px 12px; cursor:pointer; text-decoration:none; color:inherit }
  .bottom-nav{ position:sticky; bottom:0; background:#ececec; margin-top:18px; border-radius:12px; padding:12px }
  .tabs{ display:flex; justify-content:space-between; gap:10px }
  .tabs button{ flex:1; border:0; background:#e3e3e3; border-radius:10px; padding:10px; cursor:pointer }
  .add-form{ display:flex; flex-direction:column; gap:10px; margin-top:16px }
  .add-form .field-group{ display:flex; gap:8px; flex-wrap:wrap }
  .add-form input,
  .add-form textarea{ flex:1 1 140px; padding:10px 12px; border-radius:8px; border:1px solid #ddd; font:inherit }
  .add-form textarea{ min-height:72px; resize:vertical }
  .add-form button{ align-self:flex-end; border:0; background:#4a6cf7; color:#fff; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:600 }
  @media (min-width:768px){
    .wrap{ padding:24px }
    .card{ grid-template-columns:110px 1fr auto }
    .photo{ height:110px }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="section" aria-labelledby="homeTitle">
      <div id="homeTitle" class="header">Home</div>

      <div class="search" role="search">
        <form method="GET" action="/" style="display:flex; gap:8px; justify-content:center; align-items:center">
          <input type="text" name="q" value="{{ q or '' }}" placeholder="Search by name, breed, shelter..." aria-label="Search" style="flex:1; max-width:420px; padding:10px 12px; border-radius:8px; border:1px solid #ccc; font:inherit" />
          <button class="chip" type="submit" aria-label="Run search">Search</button>
          {% if q %}
          <a class="chip" href="/" aria-label="Clear search">Clear</a>
          {% endif %}
        </form>
        {% if q %}
          <div style="margin-top:6px; font-size:.95rem">Results for <strong>{{ q }}</strong></div>
        {% endif %}
      </div>

      <div class="chips" role="tablist" aria-label="Categories">
        <button class="chip active" role="tab" aria-selected="true">Dogs</button>
        <button class="chip" role="tab" aria-selected="false">Cats</button>
        <button class="chip" role="tab" aria-selected="false">SmallPet</button>
        <button class="chip" role="tab" aria-selected="false">NearMe</button>
      </div>

      {% for animal in animals %}
      <article class="card">
        <div class="photo" aria-hidden="true">
          {% if animal.photo_url %}
            <img src="{{ animal.photo_url }}" alt="Photo of {{ animal.name }}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
          {% else %}
            Pet Picture
          {% endif %}
        </div>

        <div class="meta">
          <div class="name">
            {{ animal.name }}
            {% if animal.age %} — {{ animal.age }}{% endif %}
            {% if animal.breed %} — {{ animal.breed }}{% endif %}
          </div>
          <div class="line">
            {% set distance = animal.distance %}
            {% if distance is number %}
              {% set distance_text = ('{:.1f}'.format(distance)).rstrip('0').rstrip('.') %}
            {% elif distance %}
              {% set distance_text = distance %}
            {% else %}
              {% set distance_text = None %}
            {% endif %}
            {{ distance_text if distance_text else "—" }}{% if distance_text %} mi{% endif %}
            • {{ animal.shelter or "Local Shelter" }}
          </div>
        </div>

        <div class="actions">
          <!-- NEW: Details link to details page -->
          <a class="btn" href="/details/{{ animal._id }}" aria-label="View details for {{ animal.name }}">Details →</a>

          <!-- Existing delete action -->
          <form method="POST" action="/delete/{{ animal._id }}">
            <button class="btn" type="submit" aria-label="Delete {{ animal.name }}">Delete</button>
          </form>
        </div>
      </article>
      {% else %}
      {% if q %}
        <p>No results found for "{{ q }}".</p>
      {% else %}
        <p>No animals yet. Add one below!</p>
      {% endif %}
      {% endfor %}

      <!-- Add animal (your server expects only "name") -->
      <form class="add-form" method="POST" action="/add">
        <div class="field-group">
          <input type="text" name="name" placeholder="Name" required aria-label="Animal name" />
          <input type="text" name="age" placeholder="Age" aria-label="Animal age" />
          <input type="text" name="sex" placeholder="Sex" aria-label="Animal sex" />
        </div>
        <div class="field-group">
          <input type="text" name="breed" placeholder="Breed" aria-label="Animal breed" />
          <input type="text" name="distance" placeholder="Distance (miles)" aria-label="Distance from user" inputmode="decimal" />
          <input type="text" name="shelter" placeholder="Shelter" aria-label="Shelter name" />
        </div>
        <input type="url" name="photo_url" placeholder="Photo URL" aria-label="Photo URL" />
        <input type="text" name="traits" placeholder="Traits (comma separated)" aria-label="Traits" />
        <textarea name="bio" placeholder="Bio" aria-label="Bio"></textarea>
        <textarea name="requirements" placeholder="Requirements" aria-label="Requirements"></textarea>
        <input type="text" name="address" placeholder="Shelter address" aria-label="Shelter address" />
        <button type="submit">Add Animal</button>
      </form>
    </div>

    <nav class="bottom-nav" aria-label="Bottom navigation">
      <div class="tabs">
        <button>Home</button>
        <button>Favorites</button>
        <button>Messages</button>
        <button>Profile</button>
      </div>
    </nav>
  </div>
</body>
</html>
